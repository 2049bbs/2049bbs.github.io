---
aid: 3982
cid: 13
authorID: 3615
addTime: 2020-04-01T11:00:00.000Z
title: 2049增加Google验证码代码
tags:
    - '2049'
    - Google
    - 验证码
    - 代码
    - 增加
comments: []
date: 2020-04-01T11:00:00.000Z
category: 站务
---

参考文章 [https://www.socketloop.com/tutorials/golang-recaptcha-example](https://www.socketloop.com/tutorials/golang-recaptcha-example)

1.去这里 [http://www.google.com/recaptcha/](https://www.google.com/recaptcha/) 申请secret key

2.修改代码

    https://github.com/Terminus2049/2049bbs/blob/master/view/default/desktop/userlogin.html
    <p><label>验证码： <input type="text" id="captchaSolution" class="sl w200" value="" /></label></p>
    

改为

    <p><label>验证码： <div class="g-recaptcha" data-sitekey="[第一步申请的secret key]"></div></label></p>
    

另外 修改 form\_post 函数

        function form_post(){
            var name = $('#name').val();
            var password = $('#password').val();
            var password2 = $('#password2').val();
            var g-recaptcha-response= $('#g-recaptcha-response').val();
            if(name && password && g-recaptcha-response){
                if(password && password2) {
                    if(password != password2){
                        $.toast('密码两次输入不同');
                        $('#password').val('');
                        $('#password2').val('');
                        return false;
                    }
                }
    
                $.ajax({
                    type: "POST",
                    url: "/{ {.Act} }",
                    data: JSON.stringify({'act': '{ {.Act} }', 'name': name, 'password': md5(password), 'g-recaptcha-response': g-recaptcha-response}),
                    dataType: "json",
                    success: function(data){
                        if(data.retcode==200){
                            window.location.href = "/";
                        }else{
                                reload();
                            $.toast(data.retmsg);
                        }
                    },
                    fail: function(errMsg) {
                        $.toast(errMsg);
                    }
                });
            }else{
                $.toast('用户名、密码和验证码必填');
            }
            return false;
        }
    

mobile版本，参考desktop继续修改 [https://github.com/Terminus2049/2049bbs/blob/master/view/default/mobile/userlogin.html](https://github.com/Terminus2049/2049bbs/blob/master/view/default/mobile/userlogin.html)
