---
aid: 4087
cid: 3
authorID: 3615
addTime: 2020-04-05T08:00:00.000Z
title: Win10下使用Tor创建.onion域名网站的可行性分析笔记
tags:
    - Tor
    - Win10
    - onion
    - 域名
    - 可行性
comments:
    -
        authorID: 3615
        addTime: 2020-04-05T08:00:00.000Z
        content: |-
            第二步，我开始看源码！为什么看源码？因为不看源码，我不知道缺什么东西！！！

            C:\\Users\\张怀义\\tor-alpha-3.04.1\\src\\feature\\hs\\hs\_config.c

            如果是版本2，看函数rend\_config\_service

            如果是版本3，看函数config\_service\_v3

            一头黑线。。。

            默认是什么版本啊？算了，我强制用配置项设置为版本3吧，怎么想都是版本3更好一些
    -
        authorID: 3615
        addTime: 2020-04-05T08:30:00.000Z
        content: >-
            第三步，根据第二步，我们知道了配置项有哪些。现在开始看服务具体做什么。


            C:\\Users\\张怀义\\tor-alpha-3.04.1\\src\\feature\\hs\\hs\_service.c


            hs\_service\_init 会new一个smartlist


            service\_free\_all会free刚才的smartlist


            hs\_service\_load\_all\_keys 加载或生成key


            我感觉我就是卡在上面这个函数


            hs\_check\_service\_private\_dir
            创建目录并修改权限？？？Windows下这段代码是不是有问题，因为用户权限


            ed\_key\_init\_from\_file 这个应该会生成公钥和私钥，但是看源码，不是用的openssl，而是自己实现了！


            hs\_build\_address 会生成我们的onion地址


            write\_address\_to\_file 最后写到网上说的两个文件，一个是公钥和私钥文件，一个是hostname文件


            load\_client\_keys载入代码，完成服务注册，注册服务代码是register\_service


            hs\_service\_map\_has\_changed通知服务map发生了变化
    -
        authorID: 3615
        addTime: 2020-04-05T08:30:00.000Z
        content: |-
            被打脸了，不是缺少openssl造成的。。。

            而且从代码看，使用的是椭圆曲线算法，而不是我以为的RSA算法

            意外收获是这里居然还有DoS防御等相关代码，我继续研究下为什么win10无法创建onion
date: 2020-04-05T08:30:00.000Z
category: 技术
---

我在发了

[https://2049bbs.xyz/t/4017](https://2049bbs.xyz/t/4017)

这个帖子后，打算自己在电脑上搭建一个onion网站。

经过Google，发现都是在Linux下的。我不想重装系统，就测试下win10下的可能性。

第一步，我按照Linux的方法，修改torrc文件，重启tor，报错！

一头黑线。。。

想想也是，既然需要生成公钥和私钥，肯定需要openssl啊！我win10下没装openssl，当然会报错！

但是除了openssl，onion还需要什么呢？下次估计我就没有这么好运气能猜出来缺什么了

我当然知道你们Linux下工具都是齐全的，不像我是windows，需要自己安装开源工具加到path环境变量
